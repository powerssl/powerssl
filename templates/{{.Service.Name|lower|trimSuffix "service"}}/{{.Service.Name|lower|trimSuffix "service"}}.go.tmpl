// Code generated by protoc-gen-gotemplate. DO NOT EDIT.
{{$resourceName := .Service.Name | trimSuffix "Service"}}
{{$package := $resourceName | lower}}
package {{$package}}

import (
	"github.com/go-kit/kit/log"
	"github.com/go-kit/kit/metrics"
	"github.com/jinzhu/gorm"
	"google.golang.org/grpc"

	apiv1 "powerssl.io/pkg/api/v1"
	"powerssl.io/pkg/resources"
	"powerssl.io/pkg/gen/{{$package}}/endpoint"
	"powerssl.io/pkg/gen/{{$package}}/service"
	"powerssl.io/pkg/gen/{{$package}}/transport"
)

type {{$resourceName}} struct {
	db        *gorm.DB
	endpoints endpoint.Endpoints
	logger    log.Logger
}

func New(db *gorm.DB, logger log.Logger, duration metrics.Histogram) resources.Resource {
	svc := service.New(logger)
	endpoints := endpoint.New(svc, logger, duration)

	return &{{$resourceName}}{
		db:        db,
		endpoints: endpoints,
		logger:    logger,
	}
}

func ({{$resourceName | lowerCamelCase}} *{{$resourceName}}) RegisterGRPCServer(baseServer *grpc.Server) {
	grpcServer := transport.NewGRPCServer({{$resourceName | lowerCamelCase}}.endpoints, {{$resourceName | lowerCamelCase}}.logger)
	apiv1.Register{{.Service.Name}}Server(baseServer, grpcServer)
}
